<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Doc Check Parser Pro</title>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-RDVPFB5PML"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-RDVPFB5PML');
    </script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const Download = () => (<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>);

        const CARRIER_MAP = {
            'estes': 'EXLA', 'estates': 'EXLA', 'abf': 'ABFS',
            'aaa cooper': 'AACT', 'cooper': 'AACT', 'old dominion': 'ODFL',
            'od': 'ODFL', 'global': 'GLBL', 'southeastern': 'SEFL',
            'sefl': 'SEFL', 'fedex': 'FXFE', 'fed ex': 'FXFE',
            'amazon': 'AMAZON', 'azng': 'AZNG', 'ms': 'MSOH'
        };

        const DocCheckParser = () => {
            const [input, setInput] = useState('');
            const [status, setStatus] = useState('Full');
            const [allEntries, setAllEntries] = useState([]);
            const [error, setError] = useState('');
            const [isListening, setIsListening] = useState(false);
            const [transcript, setTranscript] = useState('');
            const recognitionRef = useRef(null);

            useEffect(() => {
                if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) return;
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                const recognition = new SpeechRecognition();
                recognition.continuous = true;
                recognition.interimResults = true;
                recognition.onresult = (event) => {
                    let interim = '', final = '';
                    for (let i = event.resultIndex; i < event.results.length; i++) {
                        if (event.results[i].isFinal) final += event.results[i][0].transcript + ' ';
                        else interim += event.results[i][0].transcript;
                    }
                    if (final) { setInput(prev => prev + final.trim() + '\n'); setTranscript(''); }
                    else { setTranscript(interim); }
                };
                recognition.onend = () => { if (isListening) recognition.start(); };
                recognitionRef.current = recognition;
            }, [isListening]);

            const parseMessage = (text, currentStatus) => {
                const lines = text.split('\n').filter(l => l.trim() !== '');
                return lines.map(line => {
                    const cleanLine = line.toLowerCase().trim();
                    
                    // 1. Log Logic: Door Extraction
                    let doorVal = '';
                    const doorRegex = /(?:door|dd|dock door)\s*#?(\d{1,3})/i;
                    const doorMatch = cleanLine.match(doorRegex);
                    if (doorMatch) {
                        doorVal = `DD${doorMatch[1].padStart(3, '0')}`;
                    } else {
                        const standAloneNum = cleanLine.match(/\b(\d{1,3})\b/);
                        if (standAloneNum && parseInt(standAloneNum[1]) < 200) {
                            doorVal = `DD${standAloneNum[1].padStart(3, '0')}`;
                        }
                    }

                    // 2. Log Logic: Trailer Extraction (4-8 digits)
                    let trailerVal = '';
                    const trailerRegex = /\b([A-Z]{0,4}\d{4,8})\b/i;
                    const tMatch = cleanLine.match(trailerRegex);
                    if (tMatch) trailerVal = tMatch[0].toUpperCase();

                    // 3. Log Logic: Carrier Mapping
                    let scac = '';
                    for (const [nickname, code] of Object.entries(CARRIER_MAP)) {
                        if (cleanLine.includes(nickname)) { scac = code; break; }
                    }

                    return { 
                        door: doorVal, 
                        trailer: trailerVal, 
                        carrier: scac, 
                        status: currentStatus, 
                        timestamp: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }) 
                    };
                }).filter(e => e.door || e.trailer);
            };

            const handleLog = () => {
                if (!input.trim()) return;
                const newParsed = parseMessage(input, status);
                if (newParsed.length === 0) {
                    setError("Could not log. Try 'Door 52 trailer 12345'");
                    return;
                }
                setAllEntries(prev => [...newParsed, ...prev]);
                setInput('');
                setError('');
            };

            const exportReport = () => {
                const data = allEntries.map(e => ({
                    'Time': e.timestamp, 'Door': e.door, 'Carrier': e.carrier,
                    'Trailer': e.trailer, 'Status': e.status
                }));
                const ws = XLSX.utils.json_to_sheet(data);
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, "Dock Checks");
                XLSX.writeFile(wb, `DockCheck_${new Date().toLocaleDateString()}.xlsx`);
            };

            return (
                <div className="min-h-screen bg-gray-100 p-4 font-sans">
                    <div className="max-w-xl mx-auto bg-white rounded-2xl shadow-2xl p-6 border border-gray-200">
                        
                        {/* Header */}
                        <div className="flex justify-between items-center mb-6 border-b pb-4">
                            <div>
                                <h1 className="text-xl font-black text-indigo-900 uppercase">Dock Check Pro</h1>
                                <p className="text-[10px] text-gray-400 font-bold uppercase tracking-widest">Parser Active</p>
                            </div>
                            <button onClick={exportReport} className="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-xl text-xs font-black flex items-center gap-2 transition-all active:scale-95 shadow-lg">
                                <Download /> EXCEL
                            </button>
                        </div>

                        {/* Controls */}
                        <div className="grid grid-cols-2 gap-4 mb-4">
                            <div className="bg-gray-50 p-3 rounded-xl border border-gray-100">
                                <label className="block text-[10px] font-black text-gray-400 uppercase mb-1">Set Status</label>
                                <select value={status} onChange={(e) => setStatus(e.target.value)} className="w-full bg-transparent text-sm font-black text-indigo-900 outline-none cursor-pointer">
                                    <option value="Full">FULL (LOADED)</option>
                                    <option value="Empty">EMPTY (AVAIL)</option>
                                </select>
                            </div>
                            <button onClick={() => { if (isListening) recognitionRef.current?.stop(); else recognitionRef.current?.start(); setIsListening(!isListening); }} 
                                    className={`rounded-xl text-xs font-black transition-all shadow-lg active:scale-95 ${isListening ? 'bg-red-500 text-white animate-pulse' : 'bg-indigo-600 text-white hover:bg-indigo-700'}`}>
                                {isListening ? "‚èπ STOP RECORDING" : "üé§ VOICE INPUT"}
                            </button>
                        </div>

                        {/* Input Area */}
                        <div className="relative mb-4">
                            {error && <div className="absolute -top-4 right-0 text-red-500 text-[10px] font-black uppercase">{error}</div>}
                            {isListening && transcript && <div className="absolute -top-4 left-0 text-indigo-600 italic text-[10px] font-bold">Hearing: {transcript}</div>}
                            <textarea value={input} onChange={(e) => setInput(e.target.value)} className="w-full h-24 p-4 border-2 border-gray-100 rounded-2xl bg-gray-50 text-sm font-medium focus:border-indigo-500 focus:bg-white outline-none transition-all shadow-inner" placeholder="Example: DD052 trailer 12345 Estes" />
                        </div>

                        {/* Log Button */}
                        <button onClick={handleLog} className="w-full bg-indigo-900 hover:bg-black text-white py-4 rounded-2xl font-black text-sm tracking-[0.2em] transition-all active:scale-95 shadow-xl mb-6">
                            ADD TO LOG
                        </button>

                        {/* Recent Entry Preview */}
                        {allEntries.length > 0 && (
                            <div className="mb-4 p-3 bg-indigo-50 rounded-xl border border-indigo-100 flex justify-between items-center">
                                <span className="text-[10px] font-black text-indigo-400 uppercase">Last Entry:</span>
                                <span className="text-xs font-black text-indigo-900">{allEntries[0].door} | {allEntries[0].trailer} | {allEntries[0].carrier}</span>
                            </div>
                        )}

                        {/* Log Table */}
                        <div className="bg-white border border-gray-100 rounded-2xl overflow-hidden shadow-sm">
                            <table className="w-full text-left">
                                <thead className="bg-gray-50 text-[10px] text-gray-400 font-black uppercase tracking-tighter">
                                    <tr>
                                        <th className="p-4">Door</th>
                                        <th className="p-4">Trailer</th>
                                        <th className="p-4">Carrier</th>
                                        <th className="p-4 text-right">Status</th>
                                    </tr>
                                </thead>
                                <tbody className="divide-y divide-gray-50">
                                    {allEntries.map((e, i) => (
                                        <tr key={i} className="text-xs hover:bg-gray-50 transition-colors">
                                            <td className="p-4 font-mono font-black text-indigo-600">{e.door}</td>
                                            <td className="p-4 font-bold text-gray-800">{e.trailer}</td>
                                            <td className="p-4 font-black text-gray-400">{e.carrier}</td>
                                            <td className="p-4 text-right font-black uppercase">
                                                <span className={e.status === 'Full' ? 'text-orange-500' : 'text-green-500'}>{e.status}</span>
                                            </td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                        
                        {allEntries.length > 0 && (
                            <button onClick={() => setAllEntries([])} className="w-full mt-4 text-[10px] font-black text-gray-300 hover:text-red-400 uppercase tracking-widest transition-colors">
                                Clear Log History
                            </button>
                        )}
                    </div>
                </div>
            );
        };

        ReactDOM.render(<DocCheckParser />, document.getElementById('root'));
    </script>
</body>
</html>



